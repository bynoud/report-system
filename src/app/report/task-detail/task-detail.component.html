
<div class="card card-shadow">
  <div class="card-header" data-toggle="collapse" attr.data-target="#report-comments-{{task.uid}}">
    <div class='d-flex align-items-start'
      data-toggle="tooltip" data-placement="right" [title]="taskStatus.desc">
        <i [className]="'status-icon ' + taskStatus.icon"
          [style.color]="taskStatus.iconColor"></i>
        <span class="text-primary font-weight-bold mr-2 text-nowrap">{{task.project}}</span>
        <span class="text-secondary mr-3 truncate-on-close text-truncate font-weight-bold">
          {{task.title}}
        </span>
        <i class="fas fa-angle-down more-less"></i>
    </div>
  </div>

  <div class="card-body py-3">
    <!-- task description -->
    <p class="card-title truncate-on-close text-truncate text-muted">{{task.desc}}</p>

    <!-- task deadline -->
    <div class='mb-3'>
        <div class="btn-group btn-group-sm">
            <button type="button" class="btn btn-outline-info btn-round-left" disabled>
                    {{dateFormat(task.enteredAt)}}
            </button>

            <button type="button" class="btn dropdown-toggle btn-round-right" data-toggle="dropdown"
              [ngClass]="{'disabled': !allowModify}"
              [style.color]="taskStatus.iconColor" [style.borderColor]="taskStatus.iconColor"
              [appLoadingBy]="loadingRedue$">
                <span data-toggle="tooltip" data-placement="right" title="Click to open Re-schedule form">
                  {{dateFormat(task.due)}}</span>
            </button>

            <div class="dropdown-menu">
                <!-- <h6 class="dropdown-header">Re-schedule</h6> -->
                <form #redueForm="ngForm" (ngSubmit)="submitRedue()" class="px-4 py-3">
                  <div class="form-group">
                    <label for="redueDate">Re-schedule</label>
                    <input type="date" id="redueDate" [(ngModel)]="model.redueDate" name="redueDate" class="form-control" required>
                  </div>
                  <button type="submit" class="btn btn-primary">Change</button>
                </form>
            </div>

        </div>

        <div *ngIf="duedates.length > 0" class="dropdown d-inline"
          data-toggle="tooltip" data-placement="right" title="Click to show re-schedule history">
            <span class="badge badge-pill badge-info dropdown-toggle align-middle ml-2" 
              data-toggle="dropdown" [style.cursor]="'pointer'">{{duedates.length}}</span>
            <div class="dropdown-menu dropdown-menu-right dropdown-info-only">
                <h6 class="dropdown-header">Re-schedule history</h6>
                <p *ngFor="let d of duedates" class="dropdown-item disabled" href=''>{{dateFormat(d.due)}}</p>
            </div>
        </div>
    </div>

    <!-- task targets -->
    <div *ngFor="let target of targets">
      <app-task-target [task]="task" [target]="target" [allowModify]="allowModify"></app-task-target>
    </div>

    <!-- Comments -->
    <app-report-comment-list [task]="task" [allowNew]="allowModify"></app-report-comment-list>
    <!-- <div id="report-item--{{task.uid}}-collapse" class="collapse" data-parent="#report-collapse-parent">

      <p *ngIf='comments.length==0' class="card-text text-system ml-auto">- There's no Comment</p>

      <div *ngIf="comments.length>0" class="bg-light d-flex flex-column">
        <app-report-comment *ngFor="let comm of comments" class="card-text"
          [task]="task" [comm]="comm"></app-report-comment>
        <a *ngIf="!isLastComment" (click)="getNextComments()" [routerLink]="" class="ml-auto">... More</a>
        <span *ngIf="isLastComment" class="text-system ml-auto">- End of comments section</span>
      </div>

      <form #commForm="ngForm" (ngSubmit)="submitNewComment()" class="d-flex flex-column">
        <textarea type="text" class="form-control" rows="3" required
          [(ngModel)]="model.newComment" name="newComment" placeholder="Add your comment"></textarea>
        <button class="btn btn-primary ml-auto" type="submit" [disabled]="!commForm.valid">Add Comment</button>
      </form>

    </div> -->


  </div>

</div>
